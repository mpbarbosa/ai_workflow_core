# AI Prompt Logs

This directory contains logs of all AI prompts executed during workflow runs.

## Directory Location

- **Project workflows**: `.ai_workflow/prompts/` (in target project root)
- **Self-hosted workflows**: `.ai_workflow/prompts/` (in ai_workflow repository)

## Structure

```
.ai_workflow/prompts/
├── README.md
├── workflow_20251224_022611/
│   ├── step02_documentation_specialist_20251224_022645.md
│   ├── step05_code_reviewer_20251224_022730.md
│   └── step13_prompt_engineer_20251224_022815.md
├── workflow_20251224_010530/
│   ├── step02_documentation_specialist_20251224_010545.md
│   └── step05_test_engineer_20251224_010620.md
└── ...
```

Each workflow run has its own subdirectory following the pattern: `workflow_YYYYMMDD_HHMMSS/`

## Purpose

- **Audit Trail**: Track all AI prompts sent to GitHub Copilot CLI
- **Debugging**: Review exact prompts for troubleshooting AI responses
- **Optimization**: Analyze prompt patterns for token efficiency improvements
- **Documentation**: Reference prompt templates used in production

## File Naming Convention

Within each workflow run directory:

```
{step_name}_{persona}_{timestamp}.md
```

**Examples:**
- `step13_prompt_engineer_20251224_022645.md`
- `step02_documentation_specialist_20251224_010545.md`
- `step05_code_reviewer_20251224_011234.md`

## File Format

Each log file contains:

1. **Metadata Header**
   - Step name (e.g., step02, step05, step13)
   - AI persona (e.g., documentation_specialist, code_reviewer, prompt_engineer)
   - Timestamp (ISO 8601 format)
   - Workflow run ID

2. **Prompt Content**
   - Complete prompt text sent to GitHub Copilot CLI
   - Includes role, task, approach sections
   - May include contextual data (file lists, diffs, analysis scope)

## File Permissions

Log files are created as **read-only** (chmod 444) to prevent accidental modification and preserve audit integrity.

## Retention Policy

Prompt logs are retained indefinitely by default. Consider implementing cleanup based on:
- Age (e.g., delete logs older than 90 days)
- Storage limits
- Compliance requirements

## Usage Examples

### View Recent Workflow Runs
```bash
ls -lt .ai_workflow/prompts/ | grep ^d | head -10
```

### View Prompts for Specific Run
```bash
ls -lh .ai_workflow/prompts/workflow_20251224_022611/
```

### Search for Specific Persona
```bash
find .ai_workflow/prompts -name "*documentation_specialist*"
```

### Count Prompts by Step Across All Runs
```bash
for step in step{00..14}; do
  count=$(find .ai_workflow/prompts -name "${step}_*" | wc -l)
  echo "$step: $count prompts"
done
```

### View Latest Prompt for a Step
```bash
find .ai_workflow/prompts -name "step13_*" | sort -r | head -1 | xargs cat
```

### Analyze Token Usage Patterns
```bash
# View prompt sizes by workflow run
du -sh .ai_workflow/prompts/workflow_* | sort -h
```

## Integration

Prompt logging is automatically enabled in:
- `execute_copilot_prompt()` function (interactive mode)
- `execute_copilot_batch()` function (batch mode)

Located in: `src/workflow/lib/ai_helpers.sh`

## Related Documentation

- **AI Helpers**: `src/workflow/lib/ai_helpers.sh`
- **Prompt Templates**: `src/workflow/lib/ai_helpers.yaml`
- **Workflow Logs**: `.ai_workflow/logs/`
- **Execution Backlog**: `.ai_workflow/backlog/`
- **Summaries**: `.ai_workflow/summaries/`

## Directory Variables

The prompts directory is managed through these environment variables:

- `PROMPTS_DIR`: Base directory (`.ai_workflow/prompts`)
- `PROMPTS_RUN_DIR`: Run-specific directory (`.ai_workflow/prompts/${WORKFLOW_RUN_ID}`)
- `WORKFLOW_RUN_ID`: Unique identifier for each workflow execution

Set automatically by `src/workflow/lib/argument_parser.sh`

---

**Generated by**: AI Workflow Automation v2.3.1  
**Feature**: Prompt logging system  
**Added**: 2025-12-24  
**Updated**: 2025-12-24 (moved to .ai_workflow/prompts with per-run subdirectories)
